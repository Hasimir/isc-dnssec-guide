    <!-- === How To Test Recursive Server === -->
    <section id="how-to-test-recursive-server">
     <title>How To Test Recursive Server (So You Think You Are Validating)</title>
     <para>Okay, so now that you have reconfigured your recursive server and restarted it, how do you know that your recursive name server is actually verifying each DNS query? There are several ways to check, and we’ve listed a few suggestions below, starting with the easiest.</para>
      
      <!-- ====== Using Web-based Tools to Verify ===== -->
      <section id="using-web-based-tests-to-verify">
       <title>Using Web-based Tools to Verify</title>
       <para>For most people, the simplest way to check if the recursive name server is indeed validating DNS queries, is to use one of the many web-based tools that often employ JavaScript.</para>

       <para>Configure your client computer to use the the newly reconfigured recursive server for DNS resolution, then you can use any one of these web-based tests to see if it is in fact validating answers DNS responses.
        <itemizedlist>
         <listitem>
          <ulink url="http://test.dnssec-or-not.com/" />
         </listitem>
         <listitem>
          <ulink url="http://dnssectest.sidnlabs.nl/" />
         </listitem>
         <listitem>
          <ulink url="http://dnssec.vs.uni-due.de/" />
         </listitem>
        </itemizedlist>
       </para>
      </section>

      <!-- ====== Using dig to Verify ===== -->
      <section id="using-dig-to-verify">
       <title>Using dig to Verify</title>
       <para>If you don’t trust the JavaScript magic that the web-based tools rely on, you can take matters into your own hands and use a command line DNS tool to check your validating resolver yourself.</para>

       <para>While nslookup is popular, partly because it comes pre-installed on most systems, it is not DNSSEC-aware. The Domain Information Groper (dig), on the other hand, fully supports the DNSSEC standard, and comes as a part of BIND. If you do not have dig already installed on your system, install it by downloading it from ISC’s web site. ISC provides pre-compiled Windows versions on its web site. <!--TODO: (LINK TO APPENDIX ON HOW TO INSTALL DIG ON WINDOWS)-->.</para>

       <para>dig is a flexible tool for interrogating DNS name servers. It performs DNS lookups and displays the answers that are returned from the name server(s) that were queried. Most DNS administrators use dig to troubleshoot DNS problems because of its flexibility, ease of use, and clarity of output.</para>


       <!-- TODO: Should we even mention the DNSSEC OK (do) bit? Is it even relevent at this level? Or should we just
                  focus on the fact that RRSIG is returned, and the Authenticated Data (ad) bit is present? -->

       <para>The example below shows using dig to query the name server 192.168.1.7 for the A record for www.isc.org before DNSSEC validation is enabled. Notice although we specifically used the <command>+dnssec</command> command line option, we do not see the DNSSEC OK (<command>do</command>) bit in the response, nor do we see any DNSSEC resource records.
       <screen>$ <userinput>dig @192.168.1.7 www.isc.org. A +dnssec</userinput>
; &lt;&lt;>> DiG 9.8.3-P1 &lt;&lt;>> @192.168.1.7 www.isc.org. A +dnssec
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20416
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;www.isc.org.			IN	A

;; ANSWER SECTION:
www.isc.org.		60	IN	A	149.20.64.69</screen></para>

        <para>Below shows what the results look like querying the same server (192.168.1.7) after enabling DNSSEC validation. The exact same command is run, and this time notice three key differences, 1) the presence of the Authenticated Data (<command>ad</command>) flag in the header, 2) the DNSSEC OK (<command>do</command>) flag indicating the recursive server is DNSSEC-aware, and 3) an additional resource record of type RRSIG, with the same name as the A record.
        <screen>$ <userinput>dig @192.168.1.7 www.isc.org. A +dnssec</userinput>

;  &lt;&lt;>> DiG 9.8.4-rpz2+rl005.12-P1 &lt;&lt;>> @192.168.1.7 www.isc.org. A +dnssec
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER &lt;&lt;- opcode: QUERY, status: NOERROR, id: 56958
;; flags: qr rd ra <userinput>ad</userinput>; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: <userinput>do</userinput>; udp: 4096
;; QUESTION SECTION:
;www.isc.org.			IN	A

;; ANSWER SECTION:
www.isc.org.		60	IN	A	149.20.64.69
<userinput>www.isc.org.		60	IN	RRSIG	A 5 3 60 20141023224015 20140923224015 4521 isc.org.
                                        mL5g6RzBBrxPh9BB2ammN7tFZYTuP3IYZOu6ZtZtl2iWuNtU0gTTV9mU
                                        lMbcnXtFE/b96v4aHFo5BnOZ+Qs8l8DXg4iN5Yjub2pBZ8R6/l3eMtry
                                        4xH2nze3utPnWGZvFHeswjYR1cIHfn/jHbwJBI+m54fS3hKuR+WIF0kg
                                        wVs=</userinput></screen></para>
      </section>
      
      <!-- ====== Using delv to Verify ===== -->
      <section id="using-delv-to-verify">
       <title>Using delv to Verify</title>
       <para>If you have BIND 9.10 or later, you can use Domain Entity Lookup &amp; Validation (delv) to validate your setup. This program functions the same as dig, but is specifically tailored for DNSSEC.</para>

       <!-- TODO: (LINK TO APPENDIX A ON HOW TO INSTALL DELV ON WINDOWS). -->

       <para>Without DNSSEC:
        <screen>$ <userinput>delv @192.168.1.7 www.isc.org. A</userinput>
;; no valid RRSIG resolving 'org/DS/IN': 192.168.1.7#53
;; no valid DS resolving 'www.isc.org/A/IN': 192.168.1.7#53
;; resolution failed: no valid DS</screen></para>

       <para>delv also comes with a handy <command>+rtrace</command> (trace resolver fetches) switch that shows a little more information on what was fetched:
        <screen>$ <userinput> delv @192.168.1.7 www.isc.org. A +rtrace</userinput>
;; fetch: www.isc.org/A
;; fetch: org/DS
;; no valid RRSIG resolving 'org/DS/IN': 192.168.1.7#53
;; no valid DS resolving 'www.isc.org/A/IN': 192.168.1.7#53
;; resolution failed: no valid DS</screen></para>

       <para>After enabling DNSSEC validation, re-running the exact same commands show us the following results:
        <screen>$ <userinput>delv @192.168.1.7 www.isc.org. A</userinput>
; fully validated
www.isc.org.		43	IN	A	149.20.64.69
www.isc.org.		43	IN	RRSIG	A 5 3 60 20141025210546 20140925210546 4521 isc.org.
                                        ME+kYJuTvf16obrhqN7bfVMBUkyqc6P9a4RmbjI9r2v6j6JefFHi1RG5
                                        ZhXtHbtDJc10/qc5AA9rtEPALZXYj0q7nX/u7DNn6/mYHK9vB7N3eTYg
                                        SklGE36IyNUSjW6STvBlFnzOH6Eq65FxCAsSetgwndb6C3e+BU8vyGnk
                                        rDo=</screen></para>

       <para>And +rtrace shows all the glory of what records were fetched to validate this answer:
        <screen>$ <userinput>delv @192.168.1.7 www.isc.org +rtrace</userinput>
;; fetch: www.isc.org/A
;; fetch: isc.org/DNSKEY
;; fetch: isc.org/DS
;; fetch: org/DNSKEY
;; fetch: org/DS
;; fetch: ./DNSKEY
; fully validated
www.isc.org.		53	IN	A	149.20.64.69
www.isc.org.		53	IN	RRSIG	A 5 3 60 20141025210546 20140925210546 4521 isc.org.
                                        ME+kYJuTvf16obrhqN7bfVMBUkyqc6P9a4RmbjI9r2v6j6JefFHi1RG5
                                        ZhXtHbtDJc10/qc5AA9rtEPALZXYj0q7nX/u7DNn6/mYHK9vB7N3eTYg
                                        SklGE36IyNUSjW6STvBlFnzOH6Eq65FxCAsSetgwndb6C3e+BU8vyGnk
                                        rDo=</screen></para>
      </section>

      <!-- ====== BIND DNSSEC Debug Logging ===== -->
      <!-- TODO: Is this too much at this point of the document? Should we move this to the Troubleshooting section? -->
      <section id="dnssec-debug-logging">
       <title>BIND DNSSEC Debug Logging</title>
      </section>
    </section>

